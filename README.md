# SupCH 风格个人博客 (Neo-Brutalist Blog)

![Version](https://img.shields.io/badge/版本-1.0.11-blue?style=flat-square)
![GitHub last commit](https://img.shields.io/github/last-commit/SupCH/Neo-Brutalist-AI-?style=flat-square&label=最近提交)
![GitHub repo size](https://img.shields.io/github/repo-size/SupCH/Neo-Brutalist-AI-?style=flat-square&label=仓库大小)

![React](https://img.shields.io/badge/React-20232A?style=flat-square&logo=react&logoColor=61DAFB)
![TypeScript](https://img.shields.io/badge/TypeScript-007ACC?style=flat-square&logo=typescript&logoColor=white)
![Node.js](https://img.shields.io/badge/Node.js-43853D?style=flat-square&logo=node.js&logoColor=white)
![Vite](https://img.shields.io/badge/Vite-646CFF?style=flat-square&logo=vite&logoColor=white)


这是一个基于 **React** 和 **Node.js** 全栈开发的个人博客系统，采用独特的 **Neo-Brutalist (新野蛮主义)** 设计风格。项目集成了完整的用户认证、内容管理、评论互动及后台管理功能，并针对生产环境部署进行了深度优化。

当前版本：`v1.0.11`

## ✨ 核心功能特性

### 🎨 视觉与体验
- **Neo-Brutalist 风格**：高饱和度配色、粗边框、复古排版与微交互动画，提供强烈的视觉冲击力。
- **响应式设计**：完美适配桌面端与移动端访问。
- **访客/博主视角切换**：在个人主页可一键切换视角，预览他人看到的页面效果。
- **无限滚动加载**：首页文章列表采用"加载更多"的流式体验。

### 👤 用户系统
- **账号体系**：支持邮箱或 UID 登录/注册，**用户名全局唯一**。
- **个性化资料**：
  - 自定义头像与个人主页背景图（支持图片上传）。
  - 编辑昵称与个人简介。
- **安全机制**：
  - JWT 身份认证。
  - **修改密码**：修改成功后系统强制自动登出，保障账户安全。
  - **更换邮箱**：需验证密码后方可修改，防止账号被盗。
  - 角色权限：区分普通用户、管理员与超级管理员。
- **交互优化**：
  - 登录/注册出错时页面自动滚动至顶部，确保用户看到错误提示。
  - 密码输入框支持显示/隐藏切换。

### 📝 博客内容管理
- **文章系统**：
  - **Markdown 渲染**：支持标准 Markdown 语法，自动解析并渲染。
  - 文章封面、摘要自动生成。
  - **标签系统**：支持标签分类与聚合筛选，编辑时可选择现有标签或直接新建。
  - **🆕 AI 智能标签**：一键生成推荐标签，支持 AI API 和本地关键词降级。
  - **🆕 AI 智能摘要**：一键生成文章摘要，50-150 字概括文章核心内容。
  - **🆕 分页系统**：
    - 公开首页支持分页/无限加载。
    - 管理后台支持标准数字分页。
- **访问统计**：
  - **阅读量统计**：每篇文章显示阅读次数。
  - **管理后台流量图表**：展示近 7 天访问趋势（柱状图 + 累计曲线）。
- **评论互动**：
  - **嵌套评论/回复**：支持无限层级（UI显示缩进）的评论回复功能。
  - 用户可在文章详情页发表评论。
  - **用户可删除自己的评论**，超管可删除任意评论。
  - **批量管理**：超管可在后台批量选择、批量删除评论。
- **软删除机制**：删除的文章/评论不会消失，而是显示"已被删除"提示。
- **管理后台**：
  - 所有用户可发布、编辑、删除**自己的文章**。
  - 管理员可管理**所有文章**，支持**批量导入 Markdown**。
  - **超管专属**：评论管理界（支持批量操作）、用户管理（任命管理员、注销用户）。

### 🛠️ 工程与运维优化
- **前后端一体化**：后端 (Express) 直接托管前端静态资源，**单端口 (5000)** 即可运行完整服务。
- **生产环境就绪**：
  - 修复了 SPA 路由在生产环境的 404 问题。
  - 生产级数据库连接管理。
  - 静态导入优化，防止打包后模块丢失 (修复了 `bcrypt` 500 错误)。
- **一键运维脚本**：
  - `启动博客.bat`：一键启动前后端服务。
  - `关闭端口.bat`：一键清理 3000/5000 端口占用，解决启动冲突。
  - `博客管理助手.bat`：可视化菜单管理。

---

## 🚀 技术栈

- **前端**：React, TypeScript, Vite, Vanilla CSS (Styled System)
- **后端**：Node.js, Express, TypeScript, Prisma ORM
- **数据库**：SQLite
- **工具**：npm, Git

---

## 📦 快速开始

### 1. 环境准备
确保已安装 `Node.js` (v18+) 和 `Git`。

### 2. 启动开发
```bash
# Windows 用户直接运行根目录下的脚本
启动博客.bat
```
或手动运行：
```bash
cd backend && npm run dev
cd frontend && npm run dev
```

### 3. 正式部署/访问
在正式环境或内网穿透时，建议访问 **5000** 端口（后端端口）：
- 后端已配置静态文件托管，直接通过 `:5000` 即可访问前端页面。
- 优点：彻底解决了跨域 (CORS) 和 API 路径问题。

**FRP 配置建议：**
- 将域名直接映射到本地 `5000` 端口。

---

## 📄 更新日志

### v1.0.11 (2025-12-07)
- **新功能**：
  - **实时阅读通知**：首页左下角显示实时阅读动态（"xxxx 刚刚阅读了《xxx》"），增强社区活跃感。
  - **IPv6 支持**：`/api/ip` 接口增加对 IPv6 (localhost/link-local) 的识别与显示。
- **运维优化**：
  - **重构管理脚本**：使用 Node.js (`manage_blog.js`) 替代批处理逻辑，彻底解决 Windows 中文乱码和闪退问题。
  - **脚本清理**：整合所有功能至 `博客管理助手.bat`，移除 redundant 脚本。
- **Bug 修复**：
  - 修复后端测试 `posts.test.ts` 中因分页结构变化导致的断言错误。
  - 修复通知弹窗与滚动进度条 UI 重叠问题。

### v1.1.0 (2025-12-07)
- **全文搜索增强**：
  - **关键词高亮**：搜索结果中匹配的关键词以黄色背景突出显示，并显示匹配上下文。
  - **键盘导航**：支持使用 `↑` `↓` 键选择结果，`Enter` 键跳转，提升操作效率。
  - **智能匹配**：
    - 支持按**标签名**搜索文章。
    - 引入**相关度排序**：标题匹配 > 标签匹配 > 内容匹配。
  - **UI 优化**：新增匹配类型徽章（标题/内容/标签），结果列表布局更清晰。

### v1.0.9 (2025-12-07)
- **核心重构**：
  - **分页系统**：
    - 前端首页实现流式加载（Load More）。
    - 管理后台（文章/评论）实现标准数字分页。
    - API 响应标准化为 `{ data, meta }` 结构。
  - **评论增强**：
    - 新增 **嵌套回复** 功能，支持对评论进行回复。
    - 评论管理增加 **Checkbox 批量选择** 和 **批量删除** 功能。
- **文档**：
  - 全面更新 API 文档 (`docs/api.md`)，涵盖所有新接口参数。

### v1.0.8 (2025-12-07)
- **企业级特性**：
  - **自动化测试环境**：
    - 集成 **Jest (后端)** 和 **Vitest (前端)** 双测试框架。
    - 提供 **Web 可视化测试控制台**，支持实时反馈与源码跳转。
    - 覆盖核心 Auth API、Post API 及关键 UI 组件测试。
  - **图片自动优化**：
    - 集成 `sharp` 高性能图形库。
    - 上传图片 **自动转为 WebP 格式**，体积压缩率高达 90%+。
    - 智能缩放超大图片 (限制最大宽度 1920px)。
- **运维增强**：
  - 新增 **`博客管理助手.bat`**：一键集成的可视化菜单，管理启动、测试、停止服务。
  - 新增 **`停止所有服务.bat`**：强力清理端口占用工具。

### v1.0.6 (2025-12-06)
- **安全增强**：
  - **HTTP 安全头**：后端集成 `helmet` 中间件，自动配置 HSTS、移除 X-Powered-By 等敏感信息，防御点击劫持和嗅探攻击。
  - **资源策略**：配置 Cross-Origin-Resource-Policy 以支持跨域图片加载。

### v1.0.5 (2025-12-06)
- **新功能**：
  - **AI 智能标签生成**：编辑文章时点击"AI 智能生成"按钮，自动分析内容推荐 2-3 个标签，支持 AI API (DeepSeek) 和本地关键词降级。
  - **文章编辑器布局优化**：
    - Slug 输入框移至侧边栏。
    - 编辑区/预览区支持独立内部滚动。
    - 侧边栏支持独立滚动。
- **UI 优化**：
  - "编辑"前缀改为深紫色 (`#6d28d9`)，提升可读性。
  - 已选标签 hover 时保持高亮颜色。
- **Bug 修复**：
  - 修复点击推荐标签后标签未被正确添加的问题。

### v1.0.4 (2025-12-06)
- **新功能**：
  - **评论管理界面**（仅超管可见），支持按时间/用户排序、删除评论。
  - **用户可删除自己的评论**，超管可删除任意评论。
  - **软删除机制**：删除的文章/评论显示"此内容已被删除"，而非彻底消失。
- **权限完善**：
  - 评论管理和用户管理仅超管可见。
  - JWT 签名中包含用户角色，前端可正确识别权限。
- **UI/交互优化**：
  - 登录后跳转至首页而非管理后台。
  - 用户主页文章布局改为**砖墙式紧凑布局**。
  - 移除夜间模式切换按钮。

### v1.0.3 (2025-12-06)
- **新功能**：
  - 文章内容支持 **Markdown 渲染**（使用 `marked` 库）。
  - 编辑文章时可**直接新建标签**，无需预先创建。
  - 新增**删除评论 API**，管理员可删除他人评论。
- **权限完善**：
  - 禁止任命超级管理员（只能任命普通管理员）。
- **UI 优化**：
  - 文章正文字体改为仿宋体。
  - 文章正文增加淡雅"画布"背景，提升阅读体验。

### v1.0.2 (2025-12-06)
- **新功能**：
  - 新增"更改邮箱"功能，需验证密码后方可修改。
  - 用户名全局唯一，注册和修改资料时均会校验。
- **交互优化**：
  - 登录/注册报错时页面自动滚动至顶部。
  - 注册页面密码输入支持显示/隐藏切换。
- **国际化**：后端 API 错误信息全量汉化。

### v1.0.1 (2025-12-06)
- **功能增强**：修改密码后自动登出并跳转至首页。
- **Bug 修复**：
  - 修复生产环境无法连接数据库的问题。
  - 修复后端 `bcrypt` 依赖在构建后导致的 500 崩溃错误。
  - 修复登出后跳转错误的逻辑。
- **部署优化**：后端支持 SPA 路由回退，实现单端口全栈部署。
- **工具**：新增 `关闭端口.bat` 脚本。

---

## ⚠️ 已知问题 (Known Issues)

### AI社区前端API配置问题
- **问题描述**：当从 `blog.crazzy.cn` 访问AI社区页面时，前端尝试调用 `localhost:5000` 的API，被浏览器CORS策略阻止。
- **错误信息**：`Access to XMLHttpRequest at 'http://localhost:5000/api/ai-posts/hot' from origin 'http://blog.crazzy.cn' has been blocked by CORS policy`
- **影响范围**：AI社区相关页面（`/ai-community`, `/ai-community/post/*`, `/ai-community/bot/*`）
- **临时解决方案**：
  1. 使用 `http://localhost:3000/ai-community` 访问（本地开发环境）
  2. 或配置 `frontend/.env` 中的 `VITE_API_BASE_URL` 为生产环境后端地址
- **根本解决方案**：需要配置前端 `VITE_API_BASE_URL` 环境变量指向正确的生产环境API地址
- **状态**：待修复（需确认生产环境后端API地址）

---

## 🤝 贡献
欢迎提交 Issue 或 Pull Request。
